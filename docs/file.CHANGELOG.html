<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: CHANGELOG
  
    &mdash; Documentation by YARD 0.9.38
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "CHANGELOG";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: CHANGELOG</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><h1 id="changelog">Changelog</h1>

<p><a href="https://semver.org/spec/v2.0.0.html"><img src="https://img.shields.io/badge/semver-2.0.0-FFDD67.svg?style=flat" alt="SemVer 2.0.0"></a> <a href="https://keepachangelog.com/en/1.0.0/"><img src="https://img.shields.io/badge/keep--a--changelog-1.0.0-FFDD67.svg?style=flat" alt="Keep-A-Changelog 1.0.0"></a></p>

<p>All notable changes to this project will be documented in this file.</p>

<p>The format is based on <a href="https://keepachangelog.com/en/1.0.0/">Keep a Changelog</a>,<br>
and this project adheres to <a href="https://semver.org/spec/v2.0.0.html">Semantic Versioning</a>,<br>
and <a href="https://tom.preston-werner.com/2022/05/23/major-version-numbers-are-not-sacred.html">yes</a>, platform and engine support are part of the <a href="https://github.com/semver/semver/issues/716#issuecomment-869336139">public API</a>.<br>
Please file a bug if you notice a violation of semantic versioning.</p>

<h2 id="unreleased"><a href="https://github.com/kettle-rb/ast-merge/compare/v4.0.4...HEAD">Unreleased</a></h2>

<h3 id="added">Added</h3>

<h3 id="changed">Changed</h3>

<h3 id="deprecated">Deprecated</h3>

<h3 id="removed">Removed</h3>

<h3 id="fixed">Fixed</h3>

<ul>
  <li>Documentation fixes related to gem family section</li>
</ul>

<h3 id="security">Security</h3>

<h2 id="404---2026-01-20">
<a href="https://github.com/kettle-rb/ast-merge/compare/v4.0.3...v4.0.4">4.0.4</a> - 2026-01-20</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/releases/tag/v4.0.4">v4.0.4</a>
</li>
  <li>COVERAGE: 96.37% – 2552/2648 lines in 50 files</li>
  <li>BRANCH COVERAGE: 87.22% – 812/931 branches in 50 files</li>
  <li>98.81% documented</li>
</ul>

<h3 id="added-1">Added</h3>

<ul>
  <li>
<strong>RSpec Split Loading Pattern</strong>: New files for granular RSpec dependency tag loading
    <ul>
      <li>
<code>lib/ast/merge/rspec/setup.rb</code> - Loads only registry and helper classes (no RSpec configuration)</li>
      <li>
<code>lib/ast/merge/rspec/dependency_tags_helpers.rb</code> - DependencyTags helper module</li>
      <li>
<code>lib/ast/merge/rspec/dependency_tags_config.rb</code> - RSpec.configure block with exclusion filters</li>
      <li>Enables registering known gems before RSpec.configure runs (solving catch-22 problem)</li>
      <li>Required for ast-merge test suite to preserve SimpleCov coverage</li>
      <li>Required for merge gems that register other merge gems as dependencies</li>
    </ul>
  </li>
  <li>
<strong><code>Ast::Merge::RSpec::MergeGemRegistry.force_check_availability!</code></strong>: Deferred availability checking for accurate test coverage
    <ul>
      <li>Called automatically in <code>before(:suite)</code> hook AFTER SimpleCov is loaded</li>
      <li>Prevents premature gem loading that would bypass coverage instrumentation</li>
      <li>Ensures accurate coverage reporting in merge gem test suites</li>
    </ul>
  </li>
</ul>

<h3 id="changed-1">Changed</h3>

<ul>
  <li>
<strong>RSpec Dependency Tags</strong>: Fixed exclusion filter setup to properly skip tests when optional gems unavailable
    <ul>
      <li>Exclusion filters now set during <code>RSpec.configure</code> (not in <code>before(:suite)</code> which runs too late)</li>
      <li>Fixed RSpec API usage: <code>config.filter_run_excluding tag =&gt; true</code> (not <code>[tag] = true</code>)</li>
      <li>
<code>ast-merge</code> uses split loading pattern in <code>spec/spec_helper.rb</code> and <code>spec/config/tree_haver.rb</code>
</li>
      <li>
<code>markdown-merge</code> uses split pattern (registers <code>:commonmarker_merge</code>, <code>:markly_merge</code>)</li>
      <li>
<code>markly-merge</code> uses split pattern (registers <code>:prism_merge</code>)</li>
      <li>
<code>commonmarker-merge</code> uses simple pattern (no registrations needed)</li>
    </ul>
  </li>
</ul>

<h3 id="fixed-1">Fixed</h3>

<ul>
  <li>
<strong>Test coverage accuracy</strong>: Fixed premature gem loading that bypassed SimpleCov instrumentation
    <ul>
      <li>
<code>MergeGemRegistry.registered_gems</code> now returns ONLY explicitly registered gems, not all KNOWN_GEMS</li>
      <li>RSpec exclusion filters are configured in <code>before(:suite)</code> hook after <code>force_check_availability!</code> runs</li>
      <li>This ensures gems are loaded AFTER SimpleCov sets up coverage instrumentation</li>
      <li>Previously, commonmarker-merge reported only 11 lines covered when it should have been far more</li>
    </ul>
  </li>
  <li>
<strong>RSpec Dependency Tags</strong>: Tests with tags like <code>:markdown_merge</code>, <code>:markly_merge</code> now properly skip when those gems aren’t available
    <ul>
      <li>Fixed 141 test failures caused by tests running without required gems loaded</li>
      <li>Removed <code>require</code> statements from integration specs - dependency tags handle gem loading</li>
      <li>Fixed tag usage: Tests using <code>Markdown::Merge::PartialTemplateMerger</code> with <code>:markly</code> backend now correctly tagged with both <code>:markdown_merge</code> and <code>:markly_merge</code>
</li>
    </ul>
  </li>
  <li>
<strong>Thread-Safety Spec</strong>: Fixed JRuby concurrency test failure in <code>NodeTyping::Normalizer#canonical_type</code>
    <ul>
      <li>Changed from unsynchronized <code>Array</code> to thread-safe <code>Queue</code> for collecting results from concurrent threads</li>
      <li>Eliminates <code>ConcurrencyError: Detected invalid array contents due to unsynchronized modifications</code>
</li>
    </ul>
  </li>
</ul>

<h2 id="403---2026-01-19">
<a href="https://github.com/kettle-rb/ast-merge/compare/v4.0.2...v4.0.3">4.0.3</a> - 2026-01-19</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/releases/tag/v4.0.3">v4.0.3</a>
</li>
  <li>COVERAGE: 97.30% – 2739/2815 lines in 53 files</li>
  <li>BRANCH COVERAGE: 89.84% – 893/994 branches in 53 files</li>
  <li>98.81% documented</li>
</ul>

<h3 id="added-2">Added</h3>

<ul>
  <li>
<strong><code>Ast::Merge::RSpec::MergeGemRegistry.register_known_gems</code></strong>: Selective registration of known merge gems for RSpec dependency tags
    <ul>
      <li>Allows test suites to explicitly register only the merge gems they need, avoiding overhead of registering all known gems</li>
      <li>Usage in <code>spec/config/tree_haver.rb</code>: <code>MergeGemRegistry.register_known_gems(:prism_merge, :commonmarker_merge)</code>
</li>
      <li>Enables proper RSpec tag-based test skipping for optional merge gem dependencies</li>
      <li>Example: Tests tagged with <code>:prism_merge</code> are automatically skipped when prism-merge isn’t available</li>
    </ul>
  </li>
</ul>

<h3 id="changed-2">Changed</h3>

<ul>
  <li>Upgrade to <a href="https://github.com/kettle-rb/tree_haver/releases/tag/v5.0.2">tree_haver v5.0.2</a>
</li>
  <li>
<strong>RSpec dependency tag load order pattern</strong>: Merge gems now load tree_haver and dependency tags early via <code>spec/config/tree_haver.rb</code>
    <ul>
      <li>Ensures <code>TreeHaver::RSpec::DependencyTags</code> is loaded before gems register themselves</li>
      <li>Pattern: Load tree_haver/rspec → Load ast/merge/rspec → Register known gems → Load library</li>
      <li>Applied to markdown-merge and markly-merge; other merge gems should follow this pattern</li>
    </ul>
  </li>
</ul>

<h2 id="402---2026-01-12">
<a href="https://github.com/kettle-rb/ast-merge/compare/v4.0.1...v4.0.2">4.0.2</a> - 2026-01-12</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/releases/tag/v4.0.2">v4.0.2</a>
</li>
  <li>COVERAGE: 97.30% – 2739/2815 lines in 53 files</li>
  <li>BRANCH COVERAGE: 89.84% – 893/994 branches in 53 files</li>
  <li>98.81% documented</li>
</ul>

<h3 id="added-3">Added</h3>

<ul>
  <li>
<strong><code>Recipe::Runner</code> target file override</strong>: Accept <code>target_files</code> parameter to override recipe targets
    <ul>
      <li>
<code>Runner.new(recipe, target_files: ["file1.md", "file2.md"])</code> - Process only specified files</li>
      <li>Paths are expanded relative to <code>base_dir</code>
</li>
      <li>When not specified, falls back to recipe’s configured targets</li>
    </ul>
  </li>
  <li>
<strong><code>exe/ast-merge-recipe</code> file arguments</strong>: Accept target files on command line
    <ul>
      <li>
<code>ast-merge-recipe recipe.yml file1.md file2.md</code> - Override recipe targets</li>
      <li>Updated help text and banner to document new usage</li>
    </ul>
  </li>
  <li>
<strong><code>bin/update_gem_family_section</code> file arguments</strong>: Accept target files on command line
    <ul>
      <li>
<code>bin/update_gem_family_section vendor/my-gem/README.md</code> - Process specific file(s)</li>
      <li>If no files specified, defaults to <code>README.md</code> + <code>vendor/*/README.md</code>
</li>
      <li>Added <code>--skip-fix</code> option to skip the formatting fix step</li>
    </ul>
  </li>
</ul>

<h3 id="changed-3">Changed</h3>

<ul>
  <li>
<strong><code>bin/update_gem_family_section</code></strong>: Refactored to use <code>OptionParser</code> for clean option handling
    <ul>
      <li>Consistent with <code>bin/fix_readme_formatting</code> style</li>
      <li>Properly separates options from file arguments</li>
    </ul>
  </li>
</ul>

<h2 id="401---2026-01-11">
<a href="https://github.com/kettle-rb/ast-merge/compare/v4.0.0...v4.0.1">4.0.1</a> - 2026-01-11</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/releases/tag/v4.0.1">v4.0.1</a>
</li>
  <li>COVERAGE: 96.45% – 2553/2647 lines in 51 files</li>
  <li>BRANCH COVERAGE: 87.41% – 812/929 branches in 51 files</li>
  <li>98.80% documented</li>
</ul>

<h3 id="added-4">Added</h3>

<ul>
  <li>
<strong><code>Ast::Merge::RSpec::MergeGemRegistry</code></strong> - Fully dynamic merge gem registration for RSpec dependency tags
    <ul>
      <li>
<code>register(tag_name, require_path:, merger_class:, test_source:, category:)</code> - Register a merge gem</li>
      <li>
<code>available?(tag_name)</code> - Check if a merge gem is available and functional</li>
      <li>
<code>registered_gems</code> - Get all registered gem tag names</li>
      <li>
<code>gems_by_category(category)</code> - Filter gems by category (:markdown, :data, :code, :config, :other)</li>
      <li>
<code>summary</code> - Get availability status of all registered gems</li>
      <li>Automatically defines <code>*_available?</code> methods on <code>DependencyTags</code> at registration time</li>
      <li>External merge gems can now get full RSpec tag support without modifying ast-merge</li>
    </ul>
  </li>
</ul>

<h3 id="changed-4">Changed</h3>

<ul>
  <li>Upgrade to <a href="https://github.com/kettle-rb/tree_haver/releases/tag/v5.0.1">tree_haver v5.0.1</a>
</li>
  <li>
<strong><code>Ast::Merge::AstNode</code> now inherits from <code>TreeHaver::Base::Node</code></strong>
    <ul>
      <li>Ensures synthetic nodes stay in sync with the canonical Node API</li>
      <li>Inherits <code>Comparable</code>, <code>Enumerable</code> from base class</li>
      <li>Retains all existing methods and behavior (Point, Location, signature, etc.)</li>
      <li>Constructor calls <code>super(self, source: source)</code> to properly initialize base class</li>
    </ul>
  </li>
  <li>
<strong>RSpec Dependency Tags refactored to use MergeGemRegistry</strong>
    <ul>
      <li>Removed hardcoded merge gem availability checks</li>
      <li>Removed <code>MERGE_GEM_TEST_SOURCES</code> constant</li>
      <li>
<code>*_available?</code> methods are now defined dynamically when gems register</li>
      <li>
<code>any_markdown_merge_available?</code> now queries registry by category</li>
      <li>RSpec exclusion filters are configured dynamically from registry</li>
    </ul>
  </li>
  <li>
<code>Ast::Merge::Testing::TestableNode</code> now delegates to <code>TreeHaver::RSpec::TestableNode</code>
    <ul>
      <li>The TestableNode implementation has been moved to tree_haver for sharing across all merge gems</li>
      <li>
<code>spec/support/testable_node.rb</code> now requires and re-exports the tree_haver version</li>
      <li>Backward compatible: existing tests continue to work unchanged</li>
    </ul>
  </li>
  <li>
<code>spec/ast/merge/node_wrapper_base_spec.rb</code> refactored to use <code>TestableNode</code> instead of mocks
    <ul>
      <li>Real TreeHaver::Node behavior for most tests</li>
      <li>Mocks only retained for edge case testing (e.g., invalid end_line before start_line)</li>
    </ul>
  </li>
</ul>

<h2 id="400---2026-01-11">
<a href="https://github.com/kettle-rb/ast-merge/compare/v3.1.0...v4.0.0">4.0.0</a> - 2026-01-11</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/releases/tag/v4.0.0">v4.0.0</a>
</li>
  <li>COVERAGE: 96.52% – 2555/2647 lines in 51 files</li>
  <li>BRANCH COVERAGE: 87.62% – 814/929 branches in 51 files</li>
  <li>98.80% documented</li>
</ul>

<h3 id="added-5">Added</h3>

<ul>
  <li>
<code>Recipe::Preset#normalize_whitespace</code> - option to collapse excessive blank lines in merged output</li>
  <li>
<code>Recipe::Preset#rehydrate_link_references</code> - option to convert inline links to reference style</li>
  <li>
<code>Recipe::Runner::Result#problems</code> - access document problems found during merge</li>
  <li>
<code>exe/ast-merge-recipe --show-problems</code> - flag to display document problems in CLI output</li>
  <li>
<code>Ast::Merge::DiffMapperBase</code> - Abstract base class for mapping unified git diffs to AST node paths
    <ul>
      <li>
<code>DiffHunk</code> struct for representing diff hunks with line numbers and content</li>
      <li>
<code>DiffLine</code> struct for individual diff lines with type (<code>:context</code>, <code>:addition</code>, <code>:removal</code>)</li>
      <li>
<code>DiffMapping</code> struct for mapping changes to AST paths with operation type</li>
      <li>
<code>DiffParseResult</code> struct for parsed diff with file paths and hunks</li>
      <li>
<code>#parse_diff(diff_text)</code> - Parse unified git diff format into structured hunks</li>
      <li>
<code>#determine_operation(hunk)</code> - Detect <code>:add</code>, <code>:remove</code>, or <code>:modify</code> from hunk content</li>
      <li>Abstract <code>#map_hunk_to_paths</code> for format-specific implementations</li>
      <li>Abstract <code>#create_analysis</code> for format-specific file analysis</li>
    </ul>
  </li>
  <li>
<code>Ast::Merge::ConflictResolverBase</code> - New options for advanced merge control:
    <ul>
      <li>
<code>recursive: true | false | Integer</code> - Control recursive merging of nested structures
        <ul>
          <li>
<code>true</code> (default): Unlimited depth recursive merging</li>
          <li>
<code>false</code>: Disabled, replace entire matched nodes</li>
          <li>
<code>Integer &gt; 0</code>: Maximum recursion depth</li>
          <li>
<code>0</code>: Invalid, raises <code>ArgumentError</code>
</li>
        </ul>
      </li>
      <li>
<code>remove_template_missing_nodes: false</code> - When <code>true</code>, removes destination nodes not present in template</li>
      <li>
<code>#should_recurse?(depth)</code> - Helper to check if recursion should continue at given depth</li>
      <li>
<code>#validate_recursive!</code> - Validation for recursive parameter</li>
    </ul>
  </li>
  <li>
<code>exe/ast-merge-diff</code> - CLI executable for applying git diffs via AST-aware merging
    <ul>
      <li>Auto-detects format from file extension (<code>.yml</code>, <code>.yaml</code>, <code>.json</code>, <code>.rb</code>, etc.)</li>
      <li>
<code>--diff FILE</code> - Path to unified diff file (use <code>-</code> for stdin, default: stdin)</li>
      <li>
<code>--original FILE</code> - Original file for AST path mapping (required)</li>
      <li>
<code>--destination FILE</code> - Destination file to merge into (required)</li>
      <li>
<code>--format FORMAT</code> - Override format auto-detection</li>
      <li>
<code>--dry-run</code> - Preview changes without writing</li>
      <li>
<code>--verbose</code> - Detailed output</li>
      <li>
<code>--add-only</code> - Only apply additions from diff</li>
      <li>
<code>--remove-only</code> - Only apply removals from diff</li>
      <li>Uses bundler/inline with dynamic gem loading based on detected format</li>
    </ul>
  </li>
</ul>

<h3 id="changed-5">Changed</h3>

<ul>
  <li>
<strong>BREAKING</strong>: Upgrade to <a href="https://github.com/kettle-rb/tree_haver/releases/tag/v5.0.0">tree_haver v5.0.0</a>
</li>
  <li>
<strong>BREAKING</strong>: Refactored navigation classes into <code>Ast::Merge::Navigable</code> namespace
    <ul>
      <li>
<code>Ast::Merge::NavigableStatement</code> → <code>Ast::Merge::Navigable::Statement</code>
</li>
      <li>
<code>Ast::Merge::InjectionPoint</code> → <code>Ast::Merge::Navigable::InjectionPoint</code>
</li>
      <li>
<code>Ast::Merge::InjectionPointFinder</code> → <code>Ast::Merge::Navigable::InjectionPointFinder</code>
</li>
      <li>Each class is now in its own file under <code>lib/ast/merge/navigable/</code>
</li>
      <li>Uses autoload for lazy loading</li>
    </ul>
  </li>
  <li>
<code>bin/fix_readme_formatting</code> - Rewritten to use SmartMerger API
    <ul>
      <li>Now uses <code>Markdown::Merge::SmartMerger</code> with <code>normalize_whitespace: :link_refs</code> and <code>rehydrate_link_references: true</code>
</li>
      <li>The <code>:link_refs</code> mode collapses excessive blank lines AND removes blank lines between consecutive link reference definitions</li>
      <li>Merges empty template with destination to apply cleanup transformations</li>
      <li>Reports duplicate link definitions, link ref spacing fixes, and other problems from <code>MergeResult#problems</code>
</li>
      <li>Removed custom regex-based link rehydration and whitespace normalization</li>
    </ul>
  </li>
</ul>

<h3 id="fixed-2">Fixed</h3>

<ul>
  <li>
<code>Ast::Merge::PartialTemplateMergerBase#normalize_matcher</code> now preserves <code>same_or_shallower</code> key from boundary config</li>
  <li>
<code>Ast::Merge::PartialTemplateMergerBase#merge</code> now passes <code>boundary_same_or_shallower</code> to <code>InjectionPointFinder#find</code>
</li>
</ul>

<h2 id="310---2026-01-08">
<a href="https://github.com/kettle-rb/ast-merge/compare/v3.0.0...v3.1.0">3.1.0</a> - 2026-01-08</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/releases/tag/v3.1.0">v3.1.0</a>
</li>
  <li>COVERAGE: 96.89% – 2465/2544 lines in 47 files</li>
  <li>BRANCH COVERAGE: 89.62% – 794/886 branches in 47 files</li>
  <li>98.75% documented</li>
</ul>

<h3 id="added-6">Added</h3>

<ul>
  <li>
<code>Ast::Merge::EmitterBase</code> - Abstract base class for format-specific emitters
    <ul>
      <li>Provides common infrastructure for converting AST structures back to text</li>
      <li>Tracks indentation level with configurable <code>indent_size</code> (default: 2 spaces)</li>
      <li>Manages output lines collection with <code>#lines</code> accessor</li>
      <li>
<code>#emit_blank_line</code> - Emit an empty line</li>
      <li>
<code>#emit_leading_comments</code> - Emit comments from CommentTracker</li>
      <li>
<code>#emit_raw_lines</code> - Emit lines without modification (preserves exact formatting)</li>
      <li>
<code>#to_s</code> - Get output as a single string with trailing newline</li>
      <li>
<code>#clear</code> - Reset emitter state</li>
      <li>
<code>#indent</code> / <code>#dedent</code> - Increase/decrease indentation level</li>
      <li>Subclass hooks: <code>#initialize_subclass_state</code>, <code>#clear_subclass_state</code>, <code>#emit_tracked_comment</code>
</li>
      <li>Used by jsonc-merge, json-merge, bash-merge, toml-merge, and psych-merge emitters</li>
    </ul>
  </li>
</ul>

<h3 id="changed-6">Changed</h3>

<ul>
  <li>tree_haver v4.0.0</li>
</ul>

<h2 id="300---2026-01-05">
<a href="https://github.com/kettle-rb/ast-merge/compare/v2.0.10...v3.0.0">3.0.0</a> - 2026-01-05</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/releases/tag/v3.0.0">v3.0.0</a>
</li>
  <li>COVERAGE: 96.93% – 2462/2540 lines in 47 files</li>
  <li>BRANCH COVERAGE: 89.62% – 794/886 branches in 47 files</li>
  <li>98.72% documented</li>
</ul>

<h3 id="added-7">Added</h3>

<ul>
  <li>
<code>TestableNode</code> spec helper class that wraps a mock in a real <code>TreeHaver::Node</code>, providing consistent API testing without relying on fragile mocks</li>
  <li>
<code>Recipe::Preset#match_refiner</code> accessor method (was missing, causing errors in Recipe::Runner)</li>
  <li>Minimal reproduction specs for <code>to_commonmark</code> normalization behavior:
    <ul>
      <li>
<code>spec/integration/link_reference_preservation_spec.rb</code> - tests link ref preservation</li>
      <li>
<code>spec/integration/table_formatting_preservation_spec.rb</code> - tests table padding preservation</li>
    </ul>
  </li>
  <li>
<code>Ast::Merge::PartialTemplateMergerBase</code> - Abstract base class for parser-agnostic partial template merging
    <ul>
      <li>
<code>#build_position_based_signature_generator</code> - Creates signature generators that match elements by position</li>
      <li>Position counters reset per document key, enabling tables at same position to match regardless of structure</li>
    </ul>
  </li>
</ul>

<h3 id="changed-7">Changed</h3>

<ul>
  <li>
<strong>BREAKING</strong>: <code>NavigableStatement#text</code> now requires nodes to conform to TreeHaver Node API (must have <code>#text</code> method)
    <ul>
      <li>Removed conditional fallbacks for <code>to_plaintext</code>, <code>to_commonmark</code>, <code>slice</code>
</li>
      <li>Nodes must now implement <code>#text</code> directly (all TreeHaver backends already do)</li>
    </ul>
  </li>
  <li>
<strong>BREAKING</strong>: <code>ContentMatchRefiner#extract_content</code> now requires nodes to conform to TreeHaver Node API
    <ul>
      <li>Removed conditional fallbacks for <code>text_content</code>, <code>string_content</code>, <code>content</code>, <code>to_s</code>
</li>
      <li>Custom <code>content_extractor</code> proc still supported for non-standard nodes</li>
    </ul>
  </li>
  <li>Signature generators and typing scripts now receive TreeHaver nodes directly (no NavigableStatement wrapping)</li>
  <li>Removed NavigableStatement wrapping from <code>FileAnalyzable#generate_signature</code> and <code>NodeTyping.process</code>
</li>
</ul>

<h3 id="removed-1">Removed</h3>

<ul>
  <li>
<strong>BREAKING</strong>: <code>Ast::Merge::PartialTemplateMerger</code> removed. Use <code>Markdown::Merge::PartialTemplateMerger</code> directly.
    <ul>
      <li>The base class <code>Ast::Merge::PartialTemplateMergerBase</code> remains for other parsers to extend</li>
      <li>Migration: change <code>Ast::Merge::PartialTemplateMerger.new(parser: :markly, ...)</code> to<br>
<code>Markdown::Merge::PartialTemplateMerger.new(backend: :markly, ...)</code>
</li>
    </ul>
  </li>
</ul>

<h3 id="fixed-3">Fixed</h3>

<ul>
  <li>
<strong>Source-based rendering</strong>: <code>Markdown::Merge::PartialTemplateMerger#node_to_text</code> now prefers extracting<br>
original source text using <code>analysis.source_range</code> instead of <code>to_commonmark</code>. This preserves:
    <ul>
      <li>Link reference definitions (no conversion to inline links)</li>
      <li>Table column padding/alignment</li>
      <li>Original formatting exactly as written</li>
    </ul>
  </li>
</ul>

<h2 id="2010---2026-01-04">
<a href="https://github.com/kettle-rb/ast-merge/compare/v2.0.9...v2.0.10">2.0.10</a> - 2026-01-04</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/releases/tag/v2.0.10">v2.0.10</a>
</li>
  <li>COVERAGE: 97.10% – 2642/2721 lines in 48 files</li>
  <li>BRANCH COVERAGE: 89.57% – 893/997 branches in 48 files</li>
  <li>98.72% documented</li>
</ul>

<h3 id="added-8">Added</h3>

<ul>
  <li>Dependency tags for <code>rbs_merge</code> and <code>not_rbs_merge</code>
</li>
</ul>

<h3 id="changed-8">Changed</h3>

<ul>
  <li>Upgraded to <code>tree_haver</code> v3.2.4 (major new features, and bug fixes, see <a href="https://github.com/kettle-rb/tree_haver/releases/tag/v3.2.4">release notes</a>)</li>
</ul>

<h3 id="fixed-4">Fixed</h3>

<ul>
  <li>
<code>PartialTemplateMerger#build_merged_content</code> previously always injected an extra newline between parts, now join is context-aware</li>
</ul>

<h2 id="209---2026-01-02">
<a href="https://github.com/kettle-rb/ast-merge/compare/v2.0.8...v2.0.9">2.0.9</a> - 2026-01-02</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/releases/tag/v2.0.9">v2.0.9</a>
</li>
  <li>COVERAGE: 97.09% – 2637/2716 lines in 48 files</li>
  <li>BRANCH COVERAGE: 89.64% – 883/985 branches in 48 files</li>
  <li>98.71% documented</li>
</ul>

<h3 id="fixed-5">Fixed</h3>

<ul>
  <li>
<strong><code>NavigableStatement.find_matching</code> now returns empty array when no criteria specified</strong> -<br>
Previously, when both <code>type: nil</code> and <code>text: nil</code> and no block was given, the method would<br>
match ALL statements (since no conditions filtered anything out). This caused<br>
<code>PartialTemplateMerger</code> to incorrectly report <code>has_section: true</code> when <code>anchor: nil</code> was passed.<br>
Now returns an empty array when no criteria are specified.</li>
</ul>

<h2 id="208---2026-01-01">
<a href="https://github.com/kettle-rb/ast-merge/compare/v2.0.7...v2.0.8">2.0.8</a> - 2026-01-01</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/releases/tag/v2.0.8">v2.0.8</a>
</li>
  <li>COVERAGE: 97.09% – 2636/2715 lines in 48 files</li>
  <li>BRANCH COVERAGE: 89.73% – 882/983 branches in 48 files</li>
  <li>98.71% documented</li>
</ul>

<h3 id="added-9">Added</h3>

<ul>
  <li>
<code>Ast::Merge::NodeWrapperBase</code> abstract base class for format-specific node wrappers
    <ul>
      <li>Provides common functionality shared by <code>*::Merge::NodeWrapper</code> classes across gems</li>
      <li>Handles source context (lines, source string), line info, comments, content extraction</li>
      <li>Defines abstract <code>#compute_signature</code> that subclasses must implement</li>
      <li>Includes <code>#node_wrapper?</code> to distinguish from <code>NodeTyping::Wrapper</code>
</li>
      <li>Includes <code>#underlying_node</code> to access the raw TreeHaver node (NOT <code>#unwrap</code> to avoid<br>
conflict with <code>NodeTyping::Wrapper#unwrap</code> semantics in <code>FileAnalyzable</code>)</li>
      <li>Documents relationship between <code>NodeWrapperBase</code> and <code>NodeTyping::Wrapper</code>:
        <ul>
          <li>
<code>NodeWrapperBase</code>: Format-specific functionality (line info, signatures, type predicates)</li>
          <li>
<code>NodeTyping::Wrapper</code>: Custom merge classification (<code>merge_type</code> attribute)</li>
        </ul>
      </li>
      <li>Nodes can be double-wrapped: <code>NodeTyping::Wrapper(Format::Merge::NodeWrapper(tree_sitter_node))</code>
</li>
      <li>Accepts <code>**options</code> in initialize for subclass-specific parameters (e.g., <code>backend</code>, <code>document_root</code>)</li>
    </ul>
  </li>
</ul>

<h2 id="207---2026-01-01">
<a href="https://github.com/kettle-rb/ast-merge/compare/v2.0.6...v2.0.7">2.0.7</a> - 2026-01-01</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/releases/tag/v2.0.7">v2.0.7</a>
</li>
  <li>COVERAGE: 97.31% – 2569/2640 lines in 47 files</li>
  <li>BRANCH COVERAGE: 89.87% – 869/967 branches in 47 files</li>
  <li>98.84% documented</li>
</ul>

<h3 id="added-10">Added</h3>

<ul>
  <li>
<code>Ast::Merge::NodeTyping::Normalizer</code> module for thread-safe backend type normalization
    <ul>
      <li>Provides shared infrastructure for format-specific normalizers (toml-merge, markdown-merge)</li>
      <li>Thread-safe backend registration via mutex-protected operations</li>
      <li>
<code>configure_normalizer</code> for initial backend mappings configuration</li>
      <li>
<code>register_backend</code> for runtime registration of new backends</li>
      <li>
<code>canonical_type</code> for mapping backend-specific types to canonical types</li>
      <li>
<code>wrap</code> for wrapping nodes with canonical merge_type</li>
      <li>
<code>registered_backends</code>, <code>backend_registered?</code>, <code>mappings_for</code>, <code>canonical_types</code> query methods</li>
    </ul>
  </li>
  <li>
<code>Ast::Merge::NodeTyping::FrozenWrapper</code> class for frozen AST nodes
    <ul>
      <li>Includes <code>Freezable</code> behavior for freeze marker support</li>
      <li>
<code>frozen_node?</code>, <code>slice</code>, <code>signature</code> methods</li>
    </ul>
  </li>
  <li>Split <code>NodeTyping</code> module into separate files following autoload pattern:
    <ul>
      <li><code>ast/merge/node_typing/wrapper.rb</code></li>
      <li><code>ast/merge/node_typing/frozen_wrapper.rb</code></li>
      <li><code>ast/merge/node_typing/normalizer.rb</code></li>
    </ul>
  </li>
  <li>Comprehensive specs for <code>NodeTyping::Normalizer</code> including thread-safety tests</li>
  <li>RBS type signatures for <code>NodeTyping::Normalizer</code> and <code>NodeTyping::FrozenWrapper</code>
</li>
</ul>

<h2 id="206---2026-01-01">
<a href="https://github.com/kettle-rb/ast-merge/compare/v2.0.5...v2.0.6">2.0.6</a> - 2026-01-01</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/releases/tag/v2.0.6">v2.0.6</a>
</li>
  <li>COVERAGE: 97.19% – 2522/2595 lines in 44 files</li>
  <li>BRANCH COVERAGE: 89.91% – 864/961 branches in 44 files</li>
  <li>98.82% documented</li>
</ul>

<h3 id="added-11">Added</h3>

<ul>
  <li>Comprehensive mocked tests for <code>Ast::Merge::Recipe::Runner</code> (47 new tests):
    <ul>
      <li>Tests for <code>#run</code> method with section found, changed, and unchanged scenarios</li>
      <li>Tests for <code>#run</code> with section not found (skipped vs appended)</li>
      <li>Tests for actual file writes in non-dry_run mode</li>
      <li>Tests for exception handling during merge</li>
      <li>Tests for <code>#summary</code> with all status counts (updated, would_update, unchanged, skipped, errors)</li>
      <li>Tests for <code>#results_by_status</code> grouping</li>
      <li>Tests for <code>#results_table</code> formatting (file, status, changed, message)</li>
      <li>Tests for <code>#summary_table</code> in both dry_run and non-dry_run modes</li>
      <li>Tests for <code>#make_relative</code> edge cases (base_dir, recipe base, unknown paths)</li>
      <li>Tests for <code>#make_relative</code> without recipe_path</li>
    </ul>
  </li>
</ul>

<h2 id="205---2025-12-31">
<a href="https://github.com/kettle-rb/ast-merge/compare/v2.0.4...v2.0.5">2.0.5</a> - 2025-12-31</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/releases/tag/v2.0.5">v2.0.5</a>
</li>
  <li>COVERAGE: 91.68% – 2379/2595 lines in 44 files</li>
  <li>BRANCH COVERAGE: 81.37% – 782/961 branches in 44 files</li>
  <li>98.82% documented</li>
</ul>

<h3 id="added-12">Added</h3>

<ul>
  <li>Comprehensive tests for <code>Ast::Merge::AstNode</code> and nested structs (Point, Location)</li>
  <li>Tests for <code>Ast::Merge::Comment::Style</code> class methods and instance methods</li>
  <li>Tests for <code>Ast::Merge::Comment::Line</code> including freeze marker detection</li>
  <li>Tests for <code>Ast::Merge::Comment::Block</code> including raw_content and children modes</li>
  <li>Tests for <code>Ast::Merge::Comment::Parser</code> edge cases (unclosed blocks, mixed content, auto-detection)</li>
  <li>Tests for <code>Ast::Merge::NavigableStatement</code> tree navigation methods</li>
  <li>Tests for <code>Ast::Merge::InjectionPoint</code> (start_line, end_line, inspect)</li>
  <li>Tests for <code>Ast::Merge::InjectionPointFinder</code> boundary options (boundary_type, boundary_text, boundary_matcher, boundary_same_or_shallower)</li>
  <li>Tests for <code>Ast::Merge::PartialTemplateMerger::Result</code> including injection_point and default values</li>
  <li>Tests for <code>Ast::Merge::PartialTemplateMerger</code> text pattern normalization (regex strings, plain strings)</li>
  <li>Tests for <code>Ast::Merge::PartialTemplateMerger</code> anchor normalization with level options</li>
  <li>Tests for <code>Ast::Merge::PartialTemplateMerger</code> unknown when_missing fallback behavior</li>
  <li>Tests for <code>Ast::Merge::PartialTemplateMerger</code> section boundary detection and replace_mode behavior</li>
  <li>Tests for <code>Ast::Merge::PartialTemplateMerger</code> unknown parser error handling</li>
  <li>Tests for <code>Ast::Merge::Recipe::Runner::Result</code> stats and error attributes</li>
  <li>Tests for <code>Ast::Merge::Recipe::Runner</code> actual file writes (non-dry-run mode)</li>
  <li>Tests for <code>Ast::Merge::Recipe::Runner</code> error handling (unreadable files, missing template)</li>
  <li>Tests for <code>Ast::Merge::Recipe::Runner</code> when_missing with append behavior</li>
  <li>Tests for <code>Ast::Merge::Recipe::Config</code> same_or_shallower boundary, replace_mode, level options</li>
  <li>Tests for <code>Ast::Merge::Recipe::Config</code> injection parsing with empty/nil/Regexp patterns</li>
  <li>Tests for <code>Ast::Merge::Recipe::Config</code> expand_targets with absolute patterns</li>
  <li>Tests for <code>Ast::Merge::Recipe::Preset</code> callable add_missing and node_typing</li>
  <li>Tests for <code>Ast::Merge::Recipe::Preset</code> script_loader caching</li>
  <li>Tests for <code>Ast::Merge::Recipe::ScriptLoader</code> syntax error handling</li>
  <li>Tests for <code>Ast::Merge::Recipe::ScriptLoader</code> absolute path resolution</li>
  <li>Tests for <code>Ast::Merge::ContentMatchRefiner</code> extract_node_type with typed nodes</li>
  <li>Tests for <code>Ast::Merge::ContentMatchRefiner</code> filter_nodes with node_types</li>
</ul>

<h3 id="changed-9">Changed</h3>

<ul>
  <li>tree_haver v3.2.1</li>
  <li>Internal files now use autoload instead of <code>require_relative</code> for consistency</li>
</ul>

<h2 id="204---2025-12-31">
<a href="https://github.com/kettle-rb/ast-merge/compare/v2.0.3...v2.0.4">2.0.4</a> - 2025-12-31</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/releases/tag/v2.0.4">v2.0.4</a>
</li>
  <li>COVERAGE: 88.61% – 2903/3276 lines in 53 files</li>
  <li>BRANCH COVERAGE: 67.90% – 700/1031 branches in 53 files</li>
  <li>98.82% documented</li>
</ul>

<h3 id="added-13">Added</h3>

<ul>
  <li>Many more tests</li>
</ul>

<h3 id="fixed-6">Fixed</h3>

<ul>
  <li>RSpec shared examples for <code>Ast::Merge::DebugLogger</code> now handle Ruby 4.0+ where benchmark is a bundled gem
    <ul>
      <li>The <code>#time logs start and completion with timing</code> test now checks <code>BENCHMARK_AVAILABLE</code> constant</li>
      <li>When benchmark is available: expects full timing output with “Starting:”, “Completed:”, and <code>real_ms</code>
</li>
      <li>When benchmark is unavailable: expects warning message about benchmark gem not being available</li>
      <li>Fixes CI failures on Ruby 4.0.0 for downstream gems (e.g., bash-merge) using the shared examples</li>
    </ul>
  </li>
</ul>

<h2 id="203---2025-12-30">
<a href="https://github.com/kettle-rb/ast-merge/compare/v2.0.2...v2.0.3">2.0.3</a> - 2025-12-30</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/releases/tag/v2.0.3">v2.0.3</a>
</li>
  <li>COVERAGE: 88.45% – 2894/3272 lines in 53 files</li>
  <li>BRANCH COVERAGE: 67.83% – 698/1029 branches in 53 files</li>
  <li>98.82% documented</li>
</ul>

<h3 id="fixed-7">Fixed</h3>

<ul>
  <li>
<code>Ast::Merge::DebugLogger::BENCHMARK_AVAILABLE</code> now correctly detects when benchmark gem is unavailable
    <ul>
      <li>Previous implementation used <code>autoload</code> which never raises <code>LoadError</code> (it only registers for lazy loading)</li>
      <li>Now uses <code>require "benchmark"</code> which properly catches <code>LoadError</code> on Ruby 4.0+ where benchmark is a bundled gem</li>
      <li>The <code>#time</code> method now correctly falls back to non-timed execution when benchmark is unavailable</li>
    </ul>
  </li>
</ul>

<h2 id="202---2025-12-30">
<a href="https://github.com/kettle-rb/ast-merge/compare/v2.0.1...v2.0.2">2.0.2</a> - 2025-12-30</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/releases/tag/v2.0.2">v2.0.2</a>
</li>
  <li>COVERAGE: 88.47% – 2894/3271 lines in 53 files</li>
  <li>BRANCH COVERAGE: 67.83% – 698/1029 branches in 53 files</li>
  <li>98.82% documented</li>
</ul>

<h3 id="added-14">Added</h3>

<ul>
  <li>Backend Platform Compatibility section to README and GEM_FAMILY_SECTION.md
    <ul>
      <li>Documents which tree_haver backends work on MRI, JRuby, and TruffleRuby</li>
      <li>Explains why JRuby and TruffleRuby have limited tree-sitter backend support</li>
    </ul>
  </li>
</ul>

<h3 id="changed-10">Changed</h3>

<ul>
  <li>Updated RSpec README documentation for tree_haver dependency tag changes
    <ul>
      <li>All tags now follow consistent naming conventions with suffixes</li>
      <li>Backend tags use <code>*_backend</code> suffix</li>
      <li>Engine tags use <code>*_engine</code> suffix</li>
      <li>Grammar tags use <code>*_grammar</code> suffix</li>
      <li>Parsing capability tags use <code>*_parsing</code> suffix</li>
      <li>See <a href="lib/ast/merge/rspec/README.md">lib/ast/merge/rspec/README.md</a> for complete tag reference</li>
    </ul>
  </li>
</ul>

<h2 id="201---2025-12-29">
<a href="https://github.com/kettle-rb/ast-merge/compare/v2.0.0...v2.0.1">2.0.1</a> - 2025-12-29</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/releases/tag/v2.0.1">v2.0.1</a>
</li>
  <li>COVERAGE: 88.47% – 2894/3271 lines in 53 files</li>
  <li>BRANCH COVERAGE: 67.83% – 698/1029 branches in 53 files</li>
  <li>98.82% documented</li>
</ul>

<h3 id="changed-11">Changed</h3>

<ul>
  <li>Upgraded dependencies
    <ul>
      <li>yard-fence v0.8.1</li>
      <li>tree_haver v3.1.2</li>
      <li>kettle-test v1.0.7</li>
    </ul>
  </li>
</ul>

<h3 id="fixed-8">Fixed</h3>

<ul>
  <li>Documentation cleanup (via yard-fence)</li>
</ul>

<h2 id="200---2025-12-28">
<a href="https://github.com/kettle-rb/ast-merge/compare/v1.1.0...v2.0.0">2.0.0</a> - 2025-12-28</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/releases/tag/v2.0.0">v2.0.0</a>
</li>
  <li>COVERAGE: 88.47% – 2894/3271 lines in 53 files</li>
  <li>BRANCH COVERAGE: 67.83% – 698/1029 branches in 53 files</li>
  <li>98.82% documented</li>
</ul>

<h3 id="added-15">Added</h3>

<ul>
  <li>
<strong>RSpec Dependency Tags</strong>: Conditional test execution based on available merge gems
    <ul>
      <li>New <code>lib/ast/merge/rspec/dependency_tags.rb</code> provides automatic test filtering</li>
      <li>Tags for all merge gems: <code>:markly_merge</code>, <code>:prism_merge</code>, <code>:json_merge</code>, <code>:toml_merge</code>, etc.</li>
      <li>Composite tag <code>:any_markdown_merge</code> for tests that work with any markdown merger</li>
      <li>Negated tags (e.g., <code>:not_prism_merge</code>) for testing fallback behavior</li>
      <li>
<code>AST_MERGE_DEBUG=1</code> environment variable prints dependency summary</li>
      <li>Eliminates need for <code>require</code> statements inside spec files</li>
      <li>See <a href="lib/ast/merge/rspec/README.md">lib/ast/merge/rspec/README.md</a> for full documentation</li>
    </ul>
  </li>
  <li>
<strong>Recipe::Preset</strong>: Base class for merge configuration presets
    <ul>
      <li>Provides merge configuration (signature generators, node typing, preferences) without requiring template files</li>
      <li>
<code>Recipe::Config</code> now inherits from <code>Preset</code>, adding template/target handling</li>
      <li>
<code>to_h</code> method converts preset to SmartMerger-compatible options hash</li>
      <li>Enables kettle-jem and other libraries to define reusable merge presets</li>
      <li>Supports script loading for signature generators and node typing via <code>ScriptLoader</code>
</li>
    </ul>
  </li>
  <li>
<strong>exe/ast-merge-recipe</strong>: Shipped executable for running merge recipes
    <ul>
      <li>Uses <code>bundler/inline</code> for dependency management</li>
      <li>Supports <code>--dry-run</code>, <code>--verbose</code>, <code>--parser</code>, <code>--base-dir</code> options</li>
      <li>Uses <code>optparse</code> for proper option parsing</li>
      <li>Loads merge gems from recipe YAML <code>merge_gems</code> section</li>
      <li>Development mode via <code>KETTLE_RB_DEV=true</code> or <code>--dev-root</code> option</li>
      <li>All gems sourced from gem.coop</li>
    </ul>
  </li>
  <li>
<strong>PartialTemplateMerger</strong>: Section-based merging for partial templates
    <ul>
      <li>Find and merge specific sections in destination documents</li>
      <li>Support for both <code>replace_mode</code> (full replacement) and merge mode (intelligent merging)</li>
      <li>Configurable anchor and boundary matchers for section detection</li>
      <li>Custom <code>signature_generator</code> and <code>node_typing</code> support for advanced matching</li>
      <li>
<code>when_missing</code> behavior: <code>:skip</code>, <code>:append</code>, <code>:prepend</code>
</li>
    </ul>
  </li>
  <li>
<strong>Recipe</strong>: YAML-based recipe system for defining merge operations
    <ul>
      <li>Load recipes from YAML files with <code>Recipe.load(path)</code>
</li>
      <li>Define template, targets, injection point, merge preferences</li>
      <li>Support for <code>when_missing: skip|add|error</code> behavior</li>
      <li>Support for <code>replace_mode</code> option</li>
      <li>Automatic path resolution relative to recipe file location</li>
    </ul>
  </li>
  <li>
<strong>RecipeRunner</strong>: Execute recipes against multiple target files
    <ul>
      <li>Uses PartialTemplateMerger for section-based merging</li>
      <li>Dry-run mode with <code>--dry-run</code> flag</li>
      <li>Results tracking with status, stats, and error reporting</li>
      <li>TableTennis integration for formatted output</li>
      <li>Support for different parsers (markly, commonmarker, prism, psych)</li>
    </ul>
  </li>
  <li>
<strong>RecipeScriptLoader</strong>: Load Ruby scripts referenced by recipes
    <ul>
      <li>Convention: scripts in folder matching recipe basename (e.g., <code>my_recipe/</code> for <code>my_recipe.yml</code>)</li>
      <li>Support for inline lambda expressions in YAML</li>
      <li>Script caching for performance</li>
      <li>Validation that scripts return callable objects</li>
    </ul>
  </li>
  <li>
<strong>bin/ast-merge-recipe</strong>: CLI for running merge recipes
    <ul>
      <li><code>bin/ast-merge-recipe RECIPE_FILE [--dry-run] [--verbose]</code></li>
      <li>Color-coded output with status symbols</li>
      <li>Summary table with counts</li>
    </ul>
  </li>
  <li>
<strong>NavigableStatement</strong>: New wrapper class for uniform node navigation (language-agnostic)
    <ul>
      <li>Provides flat list navigation (<code>next</code>, <code>previous</code>, <code>index</code>) for all nodes</li>
      <li>Tree depth calculation with <code>tree_depth</code> method</li>
      <li>
<code>same_or_shallower_than?</code> for level-based boundary detection</li>
      <li>Language-agnostic section boundaries using tree hierarchy</li>
      <li>Provides tree navigation (<code>tree_parent</code>, <code>tree_next</code>, <code>tree_previous</code>) for parser-backed nodes</li>
      <li>
<code>synthetic?</code> method to detect nodes without tree navigation (GapLineNode, LinkDefinitionNode, etc.)</li>
      <li>
<code>type?</code> and <code>text_matches?</code> helpers for node matching</li>
      <li>
<code>node_attribute</code> for accessing parser-specific attributes with fallbacks</li>
      <li>
<code>each_following</code> and <code>take_until</code> for sequential traversal</li>
      <li>
<code>find_matching</code> and <code>find_first</code> class methods for querying statement lists</li>
      <li>
<code>build_list</code> class method to create linked statement lists from raw statements</li>
    </ul>
  </li>
  <li>
<strong>InjectionPoint</strong>: New class for defining where content can be injected (language-agnostic)
    <ul>
      <li>Supports positions: <code>:before</code>, <code>:after</code>, <code>:first_child</code>, <code>:last_child</code>, <code>:replace</code>
</li>
      <li>Optional boundary for replacement ranges</li>
      <li>
<code>replacement?</code>, <code>child_injection?</code>, <code>sibling_injection?</code> predicates</li>
      <li>
<code>replaced_statements</code> to get all statements in a replacement range</li>
    </ul>
  </li>
  <li>
<strong>InjectionPointFinder</strong>: New class for finding injection points by matching criteria
    <ul>
      <li>
<code>find</code> to locate a single injection point by type/text pattern</li>
      <li>
<code>find_all</code> to locate all matching injection points</li>
      <li>Works with any <code>*-merge</code> gem (prism-merge, markly-merge, psych-merge, etc.)</li>
    </ul>
  </li>
  <li>
<strong>SmartMergerBase</strong>: <code>add_template_only_nodes</code> now accepts a callable filter
    <ul>
      <li>Boolean <code>true</code>/<code>false</code> still works as before (add all or none)</li>
      <li>Callable (Proc/Lambda) receives <code>(node, entry)</code> and returns truthy to add the node</li>
      <li>Enables selective addition of template-only nodes based on signature, type, or content</li>
      <li>Example use case: Add missing link reference definitions while skipping other template content</li>
      <li>Entry hash includes <code>:template_node</code>, <code>:signature</code>, <code>:template_index</code> for filtering decisions</li>
    </ul>
  </li>
  <li>
<strong>ContentMatchRefiner</strong>: New match refiner for fuzzy text content matching
    <ul>
      <li>Uses Levenshtein distance to pair nodes with similar (but not identical) text</li>
      <li>Configurable scoring weights for content similarity, length, and position</li>
      <li>Custom content extractor support for parser-specific text extraction</li>
      <li>Node type filtering to limit which types are processed</li>
      <li>Can be combined with other refiners (e.g., TableMatchRefiner)</li>
      <li>Useful for matching paragraphs, headings, comments with minor edits</li>
    </ul>
  </li>
  <li>
<strong>SmartMergerBase</strong>: Added validity check after FileAnalysis creation
    <ul>
      <li>Checks <code>valid?</code> after creating FileAnalysis and raises appropriate parse error if invalid</li>
      <li>Catches silent failures like grammar not available or parse errors</li>
      <li>Documented the FileAnalysis error handling pattern for all *-merge gems</li>
    </ul>
  </li>
  <li>
<strong>SmartMergerBase</strong>: Added explicit <code>node_typing</code> parameter
    <ul>
      <li>All child SmartMergers were already using <code>node_typing</code> via <code>**format_options</code>
</li>
      <li>Now explicitly documented and accessible via <code>attr_reader :node_typing</code>
</li>
      <li>Validates node_typing configuration via <code>NodeTyping.validate!</code> if provided</li>
      <li>Enables per-node-type merge preferences across all <code>*-merge</code> gems</li>
    </ul>
  </li>
  <li>
<strong>ConflictResolverBase</strong>: Added <code>match_refiner</code> parameter and <code>**options</code> for forward compatibility
    <ul>
      <li>All batch-strategy resolvers were storing <code>match_refiner</code> locally</li>
      <li>Now explicitly accepted in base class with <code>attr_reader :match_refiner</code>
</li>
      <li>Added <code>**options</code> catch-all for future parameters without breaking child classes</li>
    </ul>
  </li>
  <li>
<strong>MergeResultBase</strong>: Added <code>**options</code> for forward compatibility
    <ul>
      <li>Allows subclasses to accept new parameters without modification</li>
      <li>Maintains backward compatibility with existing no-arg and keyword-arg constructors</li>
    </ul>
  </li>
  <li>
<strong>RBS Signatures</strong>: Added comprehensive type signatures for base classes
    <ul>
      <li>
<code>SmartMergerBase</code> with all standard options and abstract method declarations</li>
      <li>
<code>ConflictResolverBase</code> with strategy-based resolution methods</li>
      <li>
<code>MergeResultBase</code> with unified constructor and decision tracking</li>
      <li>
<code>MatchRefinerBase</code> with similarity computation interface</li>
      <li>
<code>RegionMergeable</code> module for nested content merging</li>
      <li>
<code>NodeTyping</code> module with <code>Wrapper</code> class for typed nodes</li>
      <li>Type aliases: <code>node_typing_callable</code>, <code>node_typing_hash</code>, <code>preference_type</code>
</li>
    </ul>
  </li>
  <li>
<strong>Documentation</strong>: Updated README with comprehensive base class documentation
    <ul>
      <li>Standard options table with all <code>SmartMergerBase</code> parameters</li>
      <li>Forward compatibility section explaining the <code>**options</code> pattern</li>
      <li>Complete “Creating a New Merge Gem” example with all base classes</li>
      <li>Base Classes Reference table</li>
    </ul>
  </li>
</ul>

<h3 id="changed-12">Changed</h3>

<ul>
  <li>
<strong>BREAKING - Namespace Reorganization</strong>: Major restructuring for better organization
    <ul>
      <li>
<code>Ast::Merge::Region</code> → <code>Ast::Merge::Detector::Region</code> (Struct moved into Detector namespace)</li>
      <li>
<code>Ast::Merge::RegionDetectorBase</code> → <code>Ast::Merge::Detector::Base</code>
</li>
      <li>
<code>Ast::Merge::RegionMergeable</code> → <code>Ast::Merge::Detector::Mergeable</code>
</li>
      <li>
<code>Ast::Merge::FencedCodeBlockDetector</code> → <code>Ast::Merge::Detector::FencedCodeBlock</code>
</li>
      <li>
<code>Ast::Merge::YamlFrontmatterDetector</code> → <code>Ast::Merge::Detector::YamlFrontmatter</code>
</li>
      <li>
<code>Ast::Merge::TomlFrontmatterDetector</code> → <code>Ast::Merge::Detector::TomlFrontmatter</code>
</li>
      <li>
<code>Ast::Merge::Recipe</code> class → <code>Ast::Merge::Recipe::Config</code>
</li>
      <li>
<code>Ast::Merge::RecipeRunner</code> → <code>Ast::Merge::Recipe::Runner</code>
</li>
      <li>
<code>Ast::Merge::RecipeScriptLoader</code> → <code>Ast::Merge::Recipe::ScriptLoader</code>
</li>
      <li>
<code>Ast::Merge::RegionMergeable::RegionConfig</code> → <code>Ast::Merge::Detector::Mergeable::Config</code>
</li>
      <li>
<code>Ast::Merge::RegionMergeable::ExtractedRegion</code> → <code>Ast::Merge::Detector::Mergeable::ExtractedRegion</code>
</li>
    </ul>
  </li>
</ul>

<h2 id="110---2025-12-18">
<a href="https://github.com/kettle-rb/ast-merge/compare/v1.0.0...v1.1.0">1.1.0</a> - 2025-12-18</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/releases/tag/v1.1.0">v1.1.0</a>
</li>
  <li>COVERAGE: 95.16% – 2338/2457 lines in 44 files</li>
  <li>BRANCH COVERAGE: 82.59% – 517/626 branches in 44 files</li>
  <li>98.45% documented</li>
</ul>

<h3 id="added-16">Added</h3>

<ul>
  <li>
<strong>tree_haver Integration</strong>: Major architectural enhancement
    <ul>
      <li>Added <code>tree_haver</code> (~&gt; 3.1) as a runtime dependency</li>
      <li>
<code>Ast::Merge::AstNode</code> now implements the TreeHaver::Node protocol for compatibility with tree_haver-based merge operations
        <ul>
          <li>Adds: <code>type</code>, <code>kind</code>, <code>text</code>, <code>start_byte</code>, <code>end_byte</code>, <code>start_point</code>, <code>end_point</code>, <code>children</code>, <code>child_count</code>, <code>child(index)</code>, <code>each</code>, <code>named?</code>, <code>structural?</code>, <code>has_error?</code>, <code>missing?</code>, <code>inner_node</code>
</li>
          <li>Adds <code>Point</code> struct compatible with <code>TreeHaver::Point</code>
</li>
          <li>Adds <code>SyntheticNode</code> alias for clarity (synthetic = not backed by a real parser)</li>
        </ul>
      </li>
      <li>
<code>Comment::Line</code>, <code>Comment::Block</code>, <code>Comment::Empty</code> now have explicit <code>type</code> methods</li>
      <li>
<code>Text::LineNode</code> and <code>Text::WordNode</code> now inherit from <code>AstNode</code>, gaining TreeHaver::Node protocol compliance</li>
      <li>This enables <code>*-merge</code> gems to leverage tree_haver’s cross-Ruby parsing capabilities (MRI, JRuby, TruffleRuby)</li>
    </ul>
  </li>
  <li>
<strong>Documentation</strong>: Comprehensive updates across the gem family
    <ul>
      <li>Updated all vendor gem READMEs with standardized gem family tables</li>
      <li>Added <code>tree_haver</code> as the foundation layer in architecture documentation</li>
      <li>Clarified the two-layer architecture: tree_haver (parsing) → ast-merge (merge infrastructure)</li>
      <li>Added detailed documentation to <code>FencedCodeBlockDetector</code> explaining when to use native AST nodes vs text-based detection</li>
      <li>Updated markdown-merge documentation to highlight inner code block merging capabilities</li>
    </ul>
  </li>
  <li>
<strong>Example Scripts</strong>: Added comprehensive examples demonstrating inner-merge capabilities
    <ul>
      <li>
<code>examples/markdown_code_merge.rb</code> - Shows how markdown-merge delegates to language-specific parsers for semantic merging</li>
      <li>Documentation proving that language-specific parsers create full ASTs of embedded code blocks</li>
    </ul>
  </li>
</ul>

<h3 id="changed-13">Changed</h3>

<ul>
  <li>
<strong>Architecture</strong>: Refactored to use tree_haver as the parsing foundation
    <ul>
      <li>All tree-sitter-based gems (bash-merge, json-merge, jsonc-merge, toml-merge) now use tree_haver</li>
      <li>Parser-specific gems (prism-merge, psych-merge, markdown-merge, markly-merge, commonmarker-merge) use tree_haver backends</li>
      <li>Provides unified API across different Ruby implementations and parsing backends</li>
    </ul>
  </li>
  <li>
<strong>Documentation Structure</strong>: Standardized gem family tables across all 12 vendor gems
    <ul>
      <li>
        <table>
          <tbody>
            <tr>
              <td>Changed from 3-column to 4-column format: Gem</td>
              <td>Format</td>
              <td>Parser Backend(s)</td>
              <td>Description</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>All parser backends now annotated with “(via tree_haver)” where applicable</li>
      <li>ast-merge description updated from “Shared infrastructure” to “<strong>Infrastructure</strong>: Shared base classes and merge logic”</li>
      <li>markdown-merge description updated to “<strong>Foundation</strong>: Shared base for Markdown mergers with inner code block merging”</li>
    </ul>
  </li>
  <li>
<strong>Configuration Documentation</strong>: Enhanced backend selection documentation</li>
</ul>

<h3 id="fixed-9">Fixed</h3>

<ul>
  <li>Fixed gemspec and Appraisals alignment with tree_haver requirements</li>
  <li>Fixed CI workflow conditions and retry logic</li>
  <li>Fixed badge rendering in documentation</li>
  <li>Fixed README structure issues (removed H3 duplicates, standardized gem family tables)</li>
</ul>

<h2 id="100---2025-12-12">
<a href="https://github.com/kettle-rb/ast-merge/compare/a63a4858cb229530c1706925bb209546695e8b3a...v1.0.0">1.0.0</a> - 2025-12-12</h2>

<ul>
  <li>TAG: <a href="https://github.com/kettle-rb/ast-merge/tags/v1.0.0">v1.0.0</a>
</li>
  <li>COVERAGE: 96.60% – 2301/2382 lines in 44 files</li>
  <li>BRANCH COVERAGE: 86.00% – 522/607 branches in 44 files</li>
  <li>99.29% documented</li>
</ul>

<h3 id="added-17">Added</h3>

<ul>
  <li>Initial release</li>
</ul>

</div></div>

      <div id="footer">
  Generated on Tue Jan 20 13:15:54 2026 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-4.0.0).
</div>

    </div>
  </body>
</html>