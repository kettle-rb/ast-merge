<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Ast::Merge::SectionTyping
  
    &mdash; Documentation by YARD 0.9.38
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Ast::Merge::SectionTyping";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Ast.html" title="Ast (module)">Ast</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Merge.html" title="Ast::Merge (module)">Merge</a></span></span>
     &raquo; 
    <span class="title">SectionTyping</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Ast::Merge::SectionTyping
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/ast/merge/section_typing.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>AST-aware section typing for identifying logical sections within parsed trees.</p>

<p>Unlike text-based splitting (see <code>Ast::Merge::Text::SectionSplitter</code>), SectionTyping<br />
works with already-parsed AST nodes where the parser has already identified<br />
structural boundaries. This eliminates the need for regex pattern matching.</p>

<h2 id="use-cases">Use Cases</h2>

<ul>
  <li>Identifying <code>appraise</code> blocks in Appraisals files</li>
  <li>Identifying <code>group</code> blocks in Gemfiles</li>
  <li>Identifying method definitions in Ruby files</li>
  <li>Any case where the AST parser provides structural information</li>
</ul>

<h2 id="how-it-works">How It Works</h2>

<ol>
  <li><strong>Classifier</strong>: A callable that inspects an AST node and returns section info</li>
  <li><strong>Typed Node</strong>: The node wrapped with its section classification</li>
  <li><strong>Merge Logic</strong>: Section-aware merging based on classifications</li>
</ol>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'><p>Defining an Appraisals block classifier</p>
</div></h5>
      
      <pre class="example code"><code><span class='const'>AppraisalClassifier</span> <span class='op'>=</span> <span class='tlambda'>-&gt;</span><span class='lparen'>(</span><span class='id identifier rubyid_node'>node</span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Prism</span><span class='op'>::</span><span class='const'>CallNode</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='symbol'>:appraise</span>

  <span class='comment'># Extract the block name from the first argument
</span>  <span class='id identifier rubyid_block_name'>block_name</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_arguments'>arguments</span><span class='op'>&amp;.</span><span class='id identifier rubyid_arguments'>arguments</span><span class='op'>&amp;.</span><span class='id identifier rubyid_first'>first</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_block_name'>block_name</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Prism</span><span class='op'>::</span><span class='const'>StringNode</span><span class='rparen'>)</span>

  <span class='lbrace'>{</span>
    <span class='label'>type:</span> <span class='symbol'>:appraise_block</span><span class='comma'>,</span>
    <span class='label'>name:</span> <span class='id identifier rubyid_block_name'>block_name</span><span class='period'>.</span><span class='id identifier rubyid_unescaped'>unescaped</span><span class='comma'>,</span>
    <span class='label'>node:</span> <span class='id identifier rubyid_node'>node</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'><p>Using the classifier</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_typing'>typing</span> <span class='op'>=</span> <span class='const'>SectionTyping</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>classifier:</span> <span class='const'>AppraisalClassifier</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sections'>sections</span> <span class='op'>=</span> <span class='id identifier rubyid_typing'>typing</span><span class='period'>.</span><span class='id identifier rubyid_classify_children'>classify_children</span><span class='lparen'>(</span><span class='id identifier rubyid_parsed_tree'>parsed_tree</span><span class='period'>.</span><span class='id identifier rubyid_statements'>statements</span><span class='rparen'>)</span>

<span class='id identifier rubyid_sections'>sections</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_section'>section</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_section'>section</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_section'>section</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
  </div>


</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="SectionTyping/CallableClassifier.html" title="Ast::Merge::SectionTyping::CallableClassifier (class)">CallableClassifier</a></span>, <span class='object_link'><a href="SectionTyping/Classifier.html" title="Ast::Merge::SectionTyping::Classifier (class)">Classifier</a></span>, <span class='object_link'><a href="SectionTyping/CompositeClassifier.html" title="Ast::Merge::SectionTyping::CompositeClassifier (class)">CompositeClassifier</a></span>, <span class='object_link'><a href="SectionTyping/TypedSection.html" title="Ast::Merge::SectionTyping::TypedSection (class)">TypedSection</a></span>
    
  
</p>







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#merge_sections-class_method" title="merge_sections (class method)">.<strong>merge_sections</strong>(template_sections, dest_sections, preference: :destination, add_template_only: false)  &#x21d2; Array&lt;TypedSection&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>TypedSection objects wrapping AST nodes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#preference_for-class_method" title="preference_for (class method)">.<strong>preference_for</strong>(section_name, preference)  &#x21d2; Symbol </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Get preference for a specific section.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="merge_sections-class_method">
  
    .<strong>merge_sections</strong>(template_sections, dest_sections, preference: :destination, add_template_only: false)  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="SectionTyping/TypedSection.html" title="Ast::Merge::SectionTyping::TypedSection (class)">TypedSection</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>TypedSection objects wrapping AST nodes.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>template_sections</span>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="SectionTyping/TypedSection.html" title="Ast::Merge::SectionTyping::TypedSection (class)">TypedSection</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Sections from template</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dest_sections</span>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="SectionTyping/TypedSection.html" title="Ast::Merge::SectionTyping::TypedSection (class)">TypedSection</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Sections from destination</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>preference</span>
      
      
        <span class='type'>(<tt>Symbol</tt>, <tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>:destination</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Merge preference (:template, :destination, or per-section Hash)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>add_template_only</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Whether to add sections only in template</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="SectionTyping/TypedSection.html" title="Ast::Merge::SectionTyping::TypedSection (class)">TypedSection</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Merged sections</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ast/merge/section_typing.rb', line 246</span>

<span class='kw'>def</span> <span class='id identifier rubyid_merge_sections'>merge_sections</span><span class='lparen'>(</span><span class='id identifier rubyid_template_sections'>template_sections</span><span class='comma'>,</span> <span class='id identifier rubyid_dest_sections'>dest_sections</span><span class='comma'>,</span> <span class='label'>preference:</span> <span class='symbol'>:destination</span><span class='comma'>,</span> <span class='label'>add_template_only:</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dest_by_name'>dest_by_name</span> <span class='op'>=</span> <span class='id identifier rubyid_dest_sections'>dest_sections</span><span class='period'>.</span><span class='id identifier rubyid_each_with_object'>each_with_object</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_section'>section</span><span class='comma'>,</span> <span class='id identifier rubyid_hash'>hash</span><span class='op'>|</span>
    <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_section'>section</span><span class='period'>.</span><span class='id identifier rubyid_normalized_name'>normalized_name</span>
    <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_section'>section</span> <span class='kw'>unless</span> <span class='id identifier rubyid_section'>section</span><span class='period'>.</span><span class='id identifier rubyid_unclassified?'>unclassified?</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_merged'>merged</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_seen_names'>seen_names</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

  <span class='id identifier rubyid_template_sections'>template_sections</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_template_section'>template_section</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_template_section'>template_section</span><span class='period'>.</span><span class='id identifier rubyid_unclassified?'>unclassified?</span>
      <span class='comment'># Unclassified sections are typically kept as-is or merged specially
</span>      <span class='id identifier rubyid_merged'>merged</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_template_section'>template_section</span> <span class='kw'>if</span> <span class='id identifier rubyid_add_template_only'>add_template_only</span>
      <span class='kw'>next</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_template_section'>template_section</span><span class='period'>.</span><span class='id identifier rubyid_normalized_name'>normalized_name</span>
    <span class='id identifier rubyid_seen_names'>seen_names</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_key'>key</span>

    <span class='id identifier rubyid_dest_section'>dest_section</span> <span class='op'>=</span> <span class='id identifier rubyid_dest_by_name'>dest_by_name</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_dest_section'>dest_section</span>
      <span class='comment'># Section exists in both - choose based on preference
</span>      <span class='id identifier rubyid_section_pref'>section_pref</span> <span class='op'>=</span> <span class='id identifier rubyid_preference_for'>preference_for</span><span class='lparen'>(</span><span class='id identifier rubyid_template_section'>template_section</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_preference'>preference</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_merged'>merged</span> <span class='op'>&lt;&lt;</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_section_pref'>section_pref</span> <span class='op'>==</span> <span class='symbol'>:template</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id identifier rubyid_template_section'>template_section</span> <span class='op'>:</span> <span class='id identifier rubyid_dest_section'>dest_section</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_add_template_only'>add_template_only</span>
      <span class='id identifier rubyid_merged'>merged</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_template_section'>template_section</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Append destination-only sections
</span>  <span class='id identifier rubyid_dest_sections'>dest_sections</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_dest_section'>dest_section</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_dest_section'>dest_section</span><span class='period'>.</span><span class='id identifier rubyid_unclassified?'>unclassified?</span>
    <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_dest_section'>dest_section</span><span class='period'>.</span><span class='id identifier rubyid_normalized_name'>normalized_name</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_seen_names'>seen_names</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_merged'>merged</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_dest_section'>dest_section</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_merged'>merged</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="preference_for-class_method">
  
    .<strong>preference_for</strong>(section_name, preference)  &#x21d2; <tt>Symbol</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Get preference for a specific section.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>section_name</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The section name</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>preference</span>
      
      
        <span class='type'>(<tt>Symbol</tt>, <tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Overall preference</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>:template or :destination</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


292
293
294
295
296
297
298
299
300
301</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ast/merge/section_typing.rb', line 292</span>

<span class='kw'>def</span> <span class='id identifier rubyid_preference_for'>preference_for</span><span class='lparen'>(</span><span class='id identifier rubyid_section_name'>section_name</span><span class='comma'>,</span> <span class='id identifier rubyid_preference'>preference</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_preference'>preference</span> <span class='kw'>unless</span> <span class='id identifier rubyid_preference'>preference</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_normalized'>normalized</span> <span class='op'>=</span> <span class='id identifier rubyid_section_name'>section_name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span>
  <span class='id identifier rubyid_preference'>preference</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_value'>value</span> <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='op'>==</span> <span class='id identifier rubyid_normalized'>normalized</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_preference'>preference</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:default</span><span class='comma'>,</span> <span class='symbol'>:destination</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sun Jan 11 22:10:09 2026 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-4.0.0).
</div>

    </div>
  </body>
</html>