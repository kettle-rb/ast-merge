<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.38
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><table>
  <thead>
    <tr>
      <th>üìç NOTE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>RubyGems (the <a href="https://github.com/rubygems/">GitHub org</a>, not the website) <a href="https://joel.drapper.me/p/ruby-central-security-measures/">suffered</a> a <a href="https://pup-e.com/blog/goodbye-rubygems/">hostile takeover</a> in September 2025.</td>
    </tr>
    <tr>
      <td>Ultimately <a href="https://www.reddit.com/r/ruby/s/gOk42POCaV">4 maintainers</a> were <a href="https://bsky.app/profile/martinemde.com/post/3m3occezxxs2q">hard removed</a> and a reason has been given for only 1 of those, while 2 others resigned in protest.</td>
    </tr>
    <tr>
      <td>It is a <a href="https://joel.drapper.me/p/ruby-central-takeover/">complicated story</a> which is difficult to <a href="https://joel.drapper.me/p/ruby-central-fact-check/">parse quickly</a>.</td>
    </tr>
    <tr>
      <td>Simply put - there was active policy for adding or removing maintainers/owners of <a href="https://github.com/ruby/rubygems/blob/b1ab33a3d52310a84d16b193991af07f5a6a07c0/doc/rubygems/POLICIES.md?plain=1#L187-L196">rubygems</a> and <a href="https://github.com/ruby/rubygems/blob/b1ab33a3d52310a84d16b193991af07f5a6a07c0/doc/bundler/playbooks/TEAM_CHANGES.md">bundler</a>, and those <a href="https://www.reddit.com/r/ruby/comments/1ove9vp/rubycentral_hates_this_one_fact/">policies were not followed</a>.</td>
    </tr>
    <tr>
      <td>I‚Äôm adding notes like this to gems because I <a href="https://joel.drapper.me/p/ruby-central/">don‚Äôt condone theft</a> of repositories or gems from their rightful owners.</td>
    </tr>
    <tr>
      <td>If a similar theft happened with my repos/gems, I‚Äôd hope some would stand up for me.</td>
    </tr>
    <tr>
      <td>Disenfranchised former-maintainers have started <a href="https://gem.coop">gem.coop</a>.</td>
    </tr>
    <tr>
      <td>Once available I will publish there exclusively; unless RubyCentral makes amends with the community.</td>
    </tr>
    <tr>
      <td>The <a href="https://youtu.be/_H4qbtC5qzU?si=BvuBU90R2wAqD2E6">‚ÄúTechnology for Humans: Joel Draper‚Äù</a> podcast episode by <a href="https://reinteractive.com/ruby-on-rails">reinteractive</a> is the most cogent summary I‚Äôm aware of.</td>
    </tr>
    <tr>
      <td>See <a href="https://github.com/gem-coop/gem.coop/issues/12">here</a>, <a href="https://gem.coop">here</a> and <a href="https://martinemde.com/2025/10/05/announcing-gem-coop.html">here</a> for more info on what comes next.</td>
    </tr>
    <tr>
      <td>What I‚Äôm doing: A (WIP) proposal for <a href="https://github.com/galtzo-floss/bundle-namespace">bundler/gem scopes</a>, and a (WIP) proposal for a federated <a href="https://github.com/galtzo-floss/gem-server">gem server</a>.</td>
    </tr>
  </tbody>
</table>

<p><a href="https://discord.gg/3qme4XHNKN"><img src="https://logos.galtzo.com/assets/images/galtzo-floss/avatar-192px.svg" alt="Galtzo FLOSS Logo by Aboling0, CC BY-SA 4.0"></a> <a href="https://www.ruby-lang.org/"><img src="https://logos.galtzo.com/assets/images/ruby-lang/avatar-192px.svg" alt="ruby-lang Logo, Yukihiro Matsumoto, Ruby Visual Identity Team, CC BY-SA 2.5"></a> <a href="https://github.com/kettle-rb"><img src="https://logos.galtzo.com/assets/images/kettle-rb/avatar-192px.svg" alt="kettle-rb Logo by Aboling0, CC BY-SA 4.0"></a></p>

<h1 id="Ô∏è-astmerge">‚òØÔ∏è Ast::Merge</h1>

<p><a href="https://bestgems.org/gems/ast-merge"><img src="https://img.shields.io/gem/v/ast-merge.svg" alt="Version"></a> <a href="http://github.com/kettle-rb/ast-merge/releases"><img src="https://img.shields.io/github/tag/kettle-rb/ast-merge.svg" alt="GitHub tag (latest SemVer)"></a> <a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-259D6C.svg" alt="License: MIT"></a> <a href="https://bestgems.org/gems/ast-merge"><img src="https://img.shields.io/gem/rd/ast-merge.svg" alt="Downloads Rank"></a> <a href="https://www.codetriage.com/kettle-rb/ast-merge"><img src="https://www.codetriage.com/kettle-rb/ast-merge/badges/users.svg" alt="Open Source Helpers"></a> <a href="https://codecov.io/gh/kettle-rb/ast-merge"><img src="https://codecov.io/gh/kettle-rb/ast-merge/graph/badge.svg" alt="CodeCov Test Coverage"></a> <a href="https://coveralls.io/github/kettle-rb/ast-merge?branch=main"><img src="https://coveralls.io/repos/github/kettle-rb/ast-merge/badge.svg?branch=main" alt="Coveralls Test Coverage"></a> <a href="https://qlty.sh/gh/kettle-rb/projects/ast-merge/metrics/code?sort=coverageRating"><img src="https://qlty.sh/gh/kettle-rb/projects/ast-merge/coverage.svg" alt="QLTY Test Coverage"></a> <a href="https://qlty.sh/gh/kettle-rb/projects/ast-merge"><img src="https://qlty.sh/gh/kettle-rb/projects/ast-merge/maintainability.svg" alt="QLTY Maintainability"></a> <a href="https://github.com/kettle-rb/ast-merge/actions/workflows/heads.yml"><img src="https://github.com/kettle-rb/ast-merge/actions/workflows/heads.yml/badge.svg" alt="CI Heads"></a> <a href="https://github.com/kettle-rb/ast-merge/actions/workflows/dep-heads.yml"><img src="https://github.com/kettle-rb/ast-merge/actions/workflows/dep-heads.yml/badge.svg" alt="CI Runtime Dependencies @ HEAD"></a> <a href="https://github.com/kettle-rb/ast-merge/actions/workflows/current.yml"><img src="https://github.com/kettle-rb/ast-merge/actions/workflows/current.yml/badge.svg" alt="CI Current"></a> <a href="https://github.com/kettle-rb/ast-merge/actions/workflows/truffle.yml"><img src="https://github.com/kettle-rb/ast-merge/actions/workflows/truffle.yml/badge.svg" alt="CI Truffle Ruby"></a> <a href="https://github.com/kettle-rb/ast-merge/actions/workflows/locked_deps.yml"><img src="https://github.com/kettle-rb/ast-merge/actions/workflows/locked_deps.yml/badge.svg" alt="Deps Locked"></a> <a href="https://github.com/kettle-rb/ast-merge/actions/workflows/unlocked_deps.yml"><img src="https://github.com/kettle-rb/ast-merge/actions/workflows/unlocked_deps.yml/badge.svg" alt="Deps Unlocked"></a> <a href="https://github.com/kettle-rb/ast-merge/actions/workflows/supported.yml"><img src="https://github.com/kettle-rb/ast-merge/actions/workflows/supported.yml/badge.svg" alt="CI Supported"></a> <a href="https://github.com/kettle-rb/ast-merge/actions/workflows/coverage.yml"><img src="https://github.com/kettle-rb/ast-merge/actions/workflows/coverage.yml/badge.svg" alt="CI Test Coverage"></a> <a href="https://github.com/kettle-rb/ast-merge/actions/workflows/style.yml"><img src="https://github.com/kettle-rb/ast-merge/actions/workflows/style.yml/badge.svg" alt="CI Style"></a> <a href="https://github.com/kettle-rb/ast-merge/security/code-scanning"><img src="https://github.com/kettle-rb/ast-merge/actions/workflows/codeql-analysis.yml/badge.svg" alt="CodeQL"></a> <a href="https://github.com/kettle-rb/ast-merge/actions/workflows/license-eye.yml"><img src="https://github.com/kettle-rb/prism-merge/actions/workflows/license-eye.yml/badge.svg" alt="Apache SkyWalking Eyes License Compatibility Check"></a></p>

<p><code>if ci_badges.map(&amp;:color).detect { it != "green"}</code> ‚òùÔ∏è <a href="https://discord.gg/3qme4XHNKN">let me know</a>, as I may have missed the <a href="https://discord.gg/3qme4XHNKN">discord notification</a>.</p>

<hr>
<p><code>if ci_badges.map(&amp;:color).all? { it == "green"}</code> üëáÔ∏è send money so I can do more of this. FLOSS maintenance is now my full-time job.</p>

<p><a href="https://opencollective.com/kettle-rb#backer"><img src="https://opencollective.com/kettle-rb/backers/badge.svg?style=flat" alt="OpenCollective Backers"></a> <a href="https://opencollective.com/kettle-rb#sponsor"><img src="https://opencollective.com/kettle-rb/sponsors/badge.svg?style=flat" alt="OpenCollective Sponsors"></a> <a href="https://github.com/sponsors/pboling"><img src="https://img.shields.io/badge/Sponsor_Me!-pboling.svg?style=social&amp;logo=github" alt="Sponsor Me on Github"></a> <a href="https://liberapay.com/pboling/donate"><img src="https://img.shields.io/liberapay/goal/pboling.svg?logo=liberapay&amp;color=a51611&amp;style=flat" alt="Liberapay Goal Progress"></a> <a href="https://www.paypal.com/paypalme/peterboling"><img src="https://img.shields.io/badge/donate-paypal-a51611.svg?style=flat&amp;logo=paypal" alt="Donate on PayPal"></a> <a href="https://www.buymeacoffee.com/pboling"><img src="https://img.shields.io/badge/buy_me_a_coffee-%E2%9C%93-a51611.svg?style=flat" alt="Buy me a coffee"></a> <a href="https://polar.sh/pboling"><img src="https://img.shields.io/badge/polar-donate-a51611.svg?style=flat" alt="Donate on Polar"></a> <a href="https://ko-fi.com/O5O86SNP4"><img src="https://img.shields.io/badge/ko--fi-%E2%9C%93-a51611.svg?style=flat" alt="Donate at ko-fi.com"></a></p>

<h2 id="-synopsis">üåª Synopsis</h2>

<p>Ast::Merge is <strong>not typically used directly</strong> - instead, use one of the format-specific gems built on top of it.</p>

<h3 id="the--merge-gem-family">The <code>*-merge</code> Gem Family</h3>

<p>The <code>*-merge</code> gem family provides intelligent, AST-based merging for various file formats. At the foundation is <a href="https://github.com/kettle-rb/tree_haver">tree_haver</a>, which provides a unified cross-Ruby parsing API that works seamlessly across MRI, JRuby, and TruffleRuby.</p>

<table>
  <thead>
    <tr>
      <th>Gem</th>
      <th>Format</th>
      <th>Parser Backend(s)</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="https://github.com/kettle-rb/tree_haver">tree_haver</a></td>
      <td>Multi</td>
      <td>MRI C, Rust, FFI, Java, Prism, Psych, Commonmarker, Markly, Citrus</td>
      <td>
<strong>Foundation</strong>: Cross-Ruby adapter for parsing libraries (like Faraday for HTTP)</td>
    </tr>
    <tr>
      <td><a href="https://github.com/kettle-rb/ast-merge">ast-merge</a></td>
      <td>Text</td>
      <td>internal</td>
      <td>
<strong>Infrastructure</strong>: Shared base classes and merge logic for all <code>*-merge</code> gems</td>
    </tr>
    <tr>
      <td><a href="https://github.com/kettle-rb/prism-merge">prism-merge</a></td>
      <td>Ruby</td>
      <td><a href="https://github.com/ruby/prism">Prism</a></td>
      <td>Smart merge for Ruby source files</td>
    </tr>
    <tr>
      <td><a href="https://github.com/kettle-rb/psych-merge">psych-merge</a></td>
      <td>YAML</td>
      <td><a href="https://github.com/ruby/psych">Psych</a></td>
      <td>Smart merge for YAML files</td>
    </tr>
    <tr>
      <td><a href="https://github.com/kettle-rb/json-merge">json-merge</a></td>
      <td>JSON</td>
      <td>
<a href="https://github.com/tree-sitter/tree-sitter-json">tree-sitter-json</a> (via tree_haver)</td>
      <td>Smart merge for JSON files</td>
    </tr>
    <tr>
      <td><a href="https://github.com/kettle-rb/jsonc-merge">jsonc-merge</a></td>
      <td>JSONC</td>
      <td>
<a href="https://gitlab.com/WhyNotHugo/tree-sitter-jsonc">tree-sitter-jsonc</a> (via tree_haver)</td>
      <td>‚ö†Ô∏è Proof of concept; Smart merge for JSON with Comments</td>
    </tr>
    <tr>
      <td><a href="https://github.com/kettle-rb/bash-merge">bash-merge</a></td>
      <td>Bash</td>
      <td>
<a href="https://github.com/tree-sitter/tree-sitter-bash">tree-sitter-bash</a> (via tree_haver)</td>
      <td>Smart merge for Bash scripts</td>
    </tr>
    <tr>
      <td><a href="https://github.com/kettle-rb/rbs-merge">rbs-merge</a></td>
      <td>RBS</td>
      <td><a href="https://github.com/ruby/rbs">RBS</a></td>
      <td>Smart merge for Ruby type signatures</td>
    </tr>
    <tr>
      <td><a href="https://github.com/kettle-rb/dotenv-merge">dotenv-merge</a></td>
      <td>Dotenv</td>
      <td>internal</td>
      <td>Smart merge for <code>.env</code> files</td>
    </tr>
    <tr>
      <td><a href="https://github.com/kettle-rb/toml-merge">toml-merge</a></td>
      <td>TOML</td>
      <td>
<a href="https://github.com/emancu/toml-rb">Citrus + toml-rb</a> (default, via tree_haver), <a href="https://github.com/tree-sitter-grammars/tree-sitter-toml">tree-sitter-toml</a> (via tree_haver)</td>
      <td>Smart merge for TOML files</td>
    </tr>
    <tr>
      <td><a href="https://github.com/kettle-rb/markdown-merge">markdown-merge</a></td>
      <td>Markdown</td>
      <td>
<a href="https://github.com/gjtorikian/commonmarker">Commonmarker</a> / <a href="https://github.com/ioquatix/markly">Markly</a> (via tree_haver)</td>
      <td>
<strong>Foundation</strong>: Shared base for Markdown mergers with inner code block merging</td>
    </tr>
    <tr>
      <td><a href="https://github.com/kettle-rb/markly-merge">markly-merge</a></td>
      <td>Markdown</td>
      <td>
<a href="https://github.com/ioquatix/markly">Markly</a> (via tree_haver)</td>
      <td>Smart merge for Markdown (CommonMark via cmark-gfm C)</td>
    </tr>
    <tr>
      <td><a href="https://github.com/kettle-rb/commonmarker-merge">commonmarker-merge</a></td>
      <td>Markdown</td>
      <td>
<a href="https://github.com/gjtorikian/commonmarker">Commonmarker</a> (via tree_haver)</td>
      <td>Smart merge for Markdown (CommonMark via comrak Rust)</td>
    </tr>
  </tbody>
</table>

<p><strong>Example implementations</strong> for the gem templating use case:</p>

<table>
  <thead>
    <tr>
      <th>Gem</th>
      <th>Purpose</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="https://github.com/kettle-rb/kettle-dev">kettle-dev</a></td>
      <td>Gem Development</td>
      <td>Gem templating tool using <code>*-merge</code> gems</td>
    </tr>
    <tr>
      <td><a href="https://github.com/kettle-rb/kettle-jem">kettle-jem</a></td>
      <td>Gem Templating</td>
      <td>Gem template library with smart merge support</td>
    </tr>
  </tbody>
</table>

<h4 id="backend-platform-compatibility">Backend Platform Compatibility</h4>

<p>tree_haver supports multiple parsing backends, but not all backends work on all Ruby platforms:</p>

<table>
  <thead>
    <tr>
      <th>Backend</th>
      <th style="text-align: center">MRI</th>
      <th style="text-align: center">JRuby</th>
      <th style="text-align: center">TruffleRuby</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
<strong>MRI</strong> (<a href="https://github.com/Faveod/ruby-tree-sitter">ruby_tree_sitter</a>)</td>
      <td style="text-align: center">‚úÖ</td>
      <td style="text-align: center">‚ùå</td>
      <td style="text-align: center">‚ùå</td>
      <td>C extension, MRI only</td>
    </tr>
    <tr>
      <td>
<strong>Rust</strong> (<a href="https://github.com/joker1007/tree_stump">tree_stump</a>)</td>
      <td style="text-align: center">‚úÖ</td>
      <td style="text-align: center">‚ùå</td>
      <td style="text-align: center">‚ùå</td>
      <td>Rust extension via magnus/rb-sys, MRI only</td>
    </tr>
    <tr>
      <td><strong>FFI</strong></td>
      <td style="text-align: center">‚úÖ</td>
      <td style="text-align: center">‚úÖ</td>
      <td style="text-align: center">‚ùå</td>
      <td>TruffleRuby‚Äôs FFI doesn‚Äôt support <code>STRUCT_BY_VALUE</code>
</td>
    </tr>
    <tr>
      <td>
<strong>Java</strong> (<a href="https://central.sonatype.com/artifact/io.github.tree-sitter/jtreesitter">jtreesitter</a>)</td>
      <td style="text-align: center">‚ùå</td>
      <td style="text-align: center">‚úÖ</td>
      <td style="text-align: center">‚ùå</td>
      <td>JRuby only, requires grammar JARs</td>
    </tr>
    <tr>
      <td><strong>Prism</strong></td>
      <td style="text-align: center">‚úÖ</td>
      <td style="text-align: center">‚úÖ</td>
      <td style="text-align: center">‚úÖ</td>
      <td>Ruby parsing, stdlib in Ruby 3.4+</td>
    </tr>
    <tr>
      <td><strong>Psych</strong></td>
      <td style="text-align: center">‚úÖ</td>
      <td style="text-align: center">‚úÖ</td>
      <td style="text-align: center">‚úÖ</td>
      <td>YAML parsing, stdlib</td>
    </tr>
    <tr>
      <td><strong>Citrus</strong></td>
      <td style="text-align: center">‚úÖ</td>
      <td style="text-align: center">‚úÖ</td>
      <td style="text-align: center">‚úÖ</td>
      <td>Pure Ruby, no native dependencies</td>
    </tr>
    <tr>
      <td><strong>Commonmarker</strong></td>
      <td style="text-align: center">‚úÖ</td>
      <td style="text-align: center">‚ùå</td>
      <td style="text-align: center">‚ùì</td>
      <td>Rust extension for Markdown</td>
    </tr>
    <tr>
      <td><strong>Markly</strong></td>
      <td style="text-align: center">‚úÖ</td>
      <td style="text-align: center">‚ùå</td>
      <td style="text-align: center">‚ùì</td>
      <td>C extension for Markdown</td>
    </tr>
  </tbody>
</table>

<p><strong>Legend</strong>: ‚úÖ = Works, ‚ùå = Does not work, ‚ùì = Untested</p>

<p><strong>Why some backends don‚Äôt work on certain platforms</strong>:</p>

<ul>
  <li>
<strong>JRuby</strong>: Runs on the JVM; cannot load native C/Rust extensions (<code>.so</code> files)</li>
  <li>
<strong>TruffleRuby</strong>: Has C API emulation via Sulong/LLVM, but it doesn‚Äôt expose all MRI internals that native extensions require (e.g., <code>RBasic.flags</code>, <code>rb_gc_writebarrier</code>)</li>
  <li>
<strong>FFI on TruffleRuby</strong>: TruffleRuby‚Äôs FFI implementation doesn‚Äôt support returning structs by value, which tree-sitter‚Äôs C API requires
    <h3 id="architecture-tree_haver--ast-merge">Architecture: tree_haver + ast-merge</h3>
  </li>
</ul>

<p>The <code>*-merge</code> gem family is built on a two-layer architecture:</p>

<h4 id="layer-1-tree_haver-parsing-foundation">Layer 1: tree_haver (Parsing Foundation)</h4>

<p><a href="https://github.com/kettle-rb/tree_haver">tree_haver</a> provides cross-Ruby parsing capabilities:</p>

<ul>
  <li>
<strong>Universal Backend Support</strong>: Automatically selects the best parsing backend for your Ruby implementation (MRI, JRuby, TruffleRuby)</li>
  <li>
<strong>10 Backend Options</strong>: MRI C extensions, Rust bindings, FFI, Java (JRuby), language-specific parsers (Prism, Psych, Commonmarker, Markly), and pure Ruby fallback (Citrus)</li>
  <li>
<strong>Unified API</strong>: Write parsing code once, run on any Ruby implementation</li>
  <li>
<strong>Grammar Discovery</strong>: Built-in <code>GrammarFinder</code> for platform-aware grammar library discovery</li>
  <li>
<strong>Thread-Safe</strong>: Language registry with thread-safe caching
    <h4 id="layer-2-ast-merge-merge-infrastructure">Layer 2: ast-merge (Merge Infrastructure)</h4>
  </li>
</ul>

<p>Ast::Merge builds on tree_haver to provide:</p>

<ul>
  <li>
<strong>Base Classes</strong>: <code>FreezeNode</code>, <code>MergeResult</code> base classes with unified constructors</li>
  <li>
<strong>Shared Modules</strong>: <code>FileAnalysisBase</code>, <code>FileAnalyzable</code>, <code>MergerConfig</code>, <code>DebugLogger</code>
</li>
  <li>
<strong>Freeze Block Support</strong>: Configurable marker patterns for multiple comment syntaxes (preserve sections during merge)</li>
  <li>
<strong>Node Typing Sys