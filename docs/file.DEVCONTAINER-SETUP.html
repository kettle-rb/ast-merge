<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: DEVCONTAINER-SETUP
  
    &mdash; Documentation by YARD 0.9.38
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "DEVCONTAINER-SETUP";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: DEVCONTAINER-SETUP</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><h1 id="tree-sitter-devcontainer-setup---distribution-summary">Tree-Sitter Devcontainer Setup - Distribution Summary</h1>

<p>This document tracks the distribution of the working tree-sitter setup pattern from <code>jsonc-merge</code> to all other merge gems that require tree-sitter support.</p>

<h2 id="pattern-overview">Pattern Overview</h2>

<p>The working pattern consists of:</p>

<ol>
  <li>
<strong><code>.devcontainer/apt-install/install.sh</code></strong> - Only installs basic system dependencies</li>
  <li>
<strong><code>.devcontainer/devcontainer.json</code></strong> - Runs tree-sitter setup in <code>postCreateCommand</code> after workspace is mounted</li>
  <li>
<strong><code>.github/scripts/ubuntu/setup-tree-sitter.sh</code></strong> - Builds and installs the grammar-specific tree-sitter library</li>
</ol>

<h2 id="key-features">Key Features</h2>

<ul>
  <li>
<strong>Workspace-aware</strong>: Uses <code>${containerWorkspaceFolder}</code> variable to work with any mount path</li>
  <li>
<strong>Runs after mount</strong>: <code>postCreateCommand</code> ensures workspace is available before running setup</li>
  <li>
<strong>GHA compatible</strong>: Same script works in both devcontainer and GitHub Actions (with <code>--sudo</code> flag)</li>
  <li>
<strong>Grammar-specific</strong>: Each gem builds its own grammar (bash, json, jsonc, toml, rbs)</li>
  <li>
<strong>Error handling</strong>: Comprehensive error checking and reporting</li>
  <li>
<strong>wget/unzip</strong>: Ensures dependencies are installed before attempting download</li>
</ul>

<h2 id="distribution-status">Distribution Status</h2>

<h3 id="-jsonc-merge-reference-implementation">✅ jsonc-merge (reference implementation)</h3>
<ul>
  <li>
<strong>Grammar</strong>: tree-sitter-jsonc from GitLab (WhyNotHugo/tree-sitter-jsonc)</li>
  <li>
<strong>Source</strong>: <code>https://gitlab.com/WhyNotHugo/tree-sitter-jsonc/-/archive/main/tree-sitter-jsonc-main.zip</code>
</li>
  <li>
<strong>Files</strong>: parser.c only (no scanner.c)</li>
  <li>
<strong>Status</strong>: ✅ Working and tested</li>
</ul>

<h3 id="-bash-merge">✅ bash-merge</h3>
<ul>
  <li>
<strong>Grammar</strong>: tree-sitter-bash from GitHub</li>
  <li>
<strong>Source</strong>: <code>https://github.com/tree-sitter/tree-sitter-bash/archive/refs/heads/master.zip</code>
</li>
  <li>
<strong>Files</strong>: parser.c + scanner.c</li>
  <li>
<strong>Updated</strong>:
    <ul>
      <li>
<code>.github/scripts/ubuntu/setup-tree-sitter.sh</code> - New script based on jsonc-merge pattern</li>
      <li>
<code>.devcontainer/devcontainer.json</code> - Added postCreateCommand</li>
      <li>
<code>.devcontainer/apt-install/install.sh</code> - Already correct (no changes needed)</li>
    </ul>
  </li>
</ul>

<h3 id="-json-merge">✅ json-merge</h3>
<ul>
  <li>
<strong>Grammar</strong>: tree-sitter-json from GitHub</li>
  <li>
<strong>Source</strong>: <code>https://github.com/tree-sitter/tree-sitter-json/archive/refs/heads/master.zip</code>
</li>
  <li>
<strong>Files</strong>: parser.c only (no scanner.c)</li>
  <li>
<strong>Updated</strong>:
    <ul>
      <li>
<code>.github/scripts/ubuntu/setup-tree-sitter.sh</code> - New script based on jsonc-merge pattern</li>
      <li>
<code>.devcontainer/devcontainer.json</code> - Added postCreateCommand</li>
    </ul>
  </li>
</ul>

<h3 id="-toml-merge">✅ toml-merge</h3>
<ul>
  <li>
<strong>Grammar</strong>: tree-sitter-toml from GitHub (tree-sitter-grammars org)</li>
  <li>
<strong>Source</strong>: <code>https://github.com/tree-sitter-grammars/tree-sitter-toml/archive/refs/heads/master.zip</code>
</li>
  <li>
<strong>Files</strong>: parser.c + scanner.c</li>
  <li>
<strong>Updated</strong>:
    <ul>
      <li>
<code>.github/scripts/ubuntu/setup-tree-sitter.sh</code> - Already had script, kept existing</li>
      <li>
<code>.devcontainer/devcontainer.json</code> - Added postCreateCommand</li>
      <li>
<code>.devcontainer/apt-install/install.sh</code> - Already correct</li>
    </ul>
  </li>
</ul>

<h3 id="-rbs-merge">✅ rbs-merge</h3>
<ul>
  <li>
<strong>Grammar</strong>: tree-sitter-rbs from GitHub (joker1007)</li>
  <li>
<strong>Source</strong>: <code>https://github.com/joker1007/tree-sitter-rbs/archive/refs/heads/main.zip</code>
</li>
  <li>
<strong>Files</strong>: parser.c + scanner.c</li>
  <li>
<strong>Updated</strong>:
    <ul>
      <li>
<code>.github/scripts/ubuntu/setup-tree-sitter.sh</code> - Created new script</li>
      <li>
<code>.devcontainer/devcontainer.json</code> - Added postCreateCommand</li>
    </ul>
  </li>
</ul>

<h2 id="gems-not-updated">Gems Not Updated</h2>

<p>The following merge gems don’t use tree-sitter or have alternative parsers:</p>

<ul>
  <li>
<strong>commonmarker-merge</strong> - Uses commonmarker gem (Rust-based markdown parser)</li>
  <li>
<strong>markdown-merge</strong> - Backend-agnostic, uses tree_haver with multiple backends</li>
  <li>
<strong>markly-merge</strong> - Uses markly gem (C-based markdown parser)</li>
  <li>
<strong>prism-merge</strong> - Uses Ruby’s Prism parser (stdlib)</li>
  <li>
<strong>psych-merge</strong> - Uses Ruby’s Psych YAML parser (stdlib)</li>
  <li>
<strong>dotenv-merge</strong> - Simple key-value parser, no AST needed</li>
</ul>

<h2 id="testing">Testing</h2>

<p>For each updated gem, test the devcontainer setup:</p>

<pre class="code language-bash"><code class="language-bash"># After rebuilding devcontainer, verify:

# 1. Check setup ran
cat /tmp/tree-sitter-setup.log

# 2. Verify library installed
ls -la /usr/local/lib/libtree-sitter-*.so

# 3. Test with tree_haver
ruby -e &quot;
require &#39;bundler/setup&#39;
require &#39;tree_haver&#39;
# Replace :grammar with :bash, :json, :jsonc, :toml, or :rbs
finder = TreeHaver::GrammarFinder.new(:grammar)
puts &#39;Path: &#39; + (finder.find_library_path || &#39;NOT FOUND&#39;)
puts &#39;Available: &#39; + finder.available?.to_s
&quot;
</code></pre>

<h2 id="grammar-specific-notes">Grammar-Specific Notes</h2>

<h3 id="jsonc-json-with-comments">jsonc (JSON with Comments)</h3>
<ul>
  <li>Maintained on <strong>GitLab</strong> (not GitHub)</li>
  <li>Has <strong>no scanner.c</strong> - only parser.c</li>
  <li>Link command: <code>gcc -shared -o libtree-sitter-jsonc.so parser.o</code>
</li>
</ul>

<h3 id="json-standard-json">json (Standard JSON)</h3>
<ul>
  <li>Official tree-sitter grammar</li>
  <li>Has <strong>no scanner.c</strong> - only parser.c</li>
  <li>Link command: <code>gcc -shared -o libtree-sitter-json.so parser.o</code>
</li>
</ul>

<h3 id="bash">bash</h3>
<ul>
  <li>Official tree-sitter grammar</li>
  <li>Has <strong>both</strong> parser.c and scanner.c</li>
  <li>Link command: <code>gcc -shared -o libtree-sitter-bash.so parser.o scanner.o</code>
</li>
</ul>

<h3 id="toml">toml</h3>
<ul>
  <li>Maintained by tree-sitter-grammars organization</li>
  <li>Has <strong>both</strong> parser.c and scanner.c</li>
  <li>Link command: <code>gcc -shared -o libtree-sitter-toml.so parser.o scanner.o</code>
</li>
</ul>

<h3 id="rbs">rbs</h3>
<ul>
  <li>Third-party grammar by joker1007</li>
  <li>Has <strong>both</strong> parser.c and scanner.c</li>
  <li>Uses <code>main</code> branch (not master)</li>
  <li>Link command: <code>gcc -shared -o libtree-sitter-rbs.so parser.o scanner.o</code>
</li>
</ul>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>If setup fails in any gem:</p>

<ol>
  <li>
<strong>Check workspace mount path</strong>: Should be <code>/IdeaProjects/&lt;gem-name&gt;</code> in RubyMine devcontainers</li>
  <li>
<strong>Verify postCreateCommand ran</strong>: Look for log at <code>/tmp/tree-sitter-setup.log</code>
</li>
  <li>
<strong>Test grammar source</strong>: Verify the download URL is accessible</li>
  <li>
<strong>Check scanner.c</strong>: Some grammars have it, some don’t - update script accordingly</li>
  <li>
<strong>Run manual setup</strong>: Each gem should have <code>.devcontainer/manual-tree-sitter-setup.sh</code>
</li>
</ol>

<h2 id="future-additions">Future Additions</h2>

<p>When adding tree-sitter support to new gems:</p>

<ol>
  <li>Copy <code>.github/scripts/ubuntu/setup-tree-sitter.sh</code> from this reference</li>
  <li>Update grammar name, URL, and file list (parser.c vs parser.c+scanner.c)</li>
  <li>Update <code>.devcontainer/devcontainer.json</code> with postCreateCommand</li>
  <li>Ensure <code>.devcontainer/apt-install/install.sh</code> only installs basic packages</li>
  <li>Test in devcontainer</li>
  <li>Document in this file</li>
</ol>
</div></div>

      <div id="footer">
  Generated on Sun Dec 28 16:22:19 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-4.0.0).
</div>

    </div>
  </body>
</html>